name: "Build and Deploy"
on:
  push:
    branches:
      - Development

jobs:
  DEV_DEPLOY:
    runs-on: self-hosted
    name: login to stage-server
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      # ... other steps ...

      - name: Sonar Scanner
        run: |
          cd /home/admin/sonarqube-test/actions-runner/_work/React_Project/React_Project
          ls
          pwd

          sonar-scanner \
            -Dsonar.projectKey=Admin-Node-Quality-Check \
            -Dsonar.sources=. \
            -Dsonar.host.url=https://sonar.testing.pluginlive.com \
            -Dsonar.login=sqp_d467fac28e1b8880aaa223bdb71a9b540abd4b00

      - name: Get SonarQube Quality Gate Status
        id: sonarqube-quality-gate
        run: |
          sonar-scanner \
            -Dsonar.qualitygate.wait=true \
            -Dsonar.qualitygate.timeout=300 \
            -Dsonar.login=sqp_d467fac28e1b8880aaa223bdb71a9b540abd4b00 \
            -Dsonar.host.url=https://sonar.testing.pluginlive.com

      - name: Display SonarQube Quality Gate Status
        run: |
          echo "SonarQube Quality Gate Status: ${{ steps.sonarqube-quality-gate.outputs.qualitygate_status }}"
          
      - name: Completed Deployment
        env:
          CARD_TITLE: "Github-actions"
          CARD_SUBTITLE: "Deployment Completed"
          JOB: "Admin Node"
          ENVIRONMENT: "${{ github.ref_name }}"
          BRANCH: "${{ github.ref_name }}"
          COMMITTED_BY: "${{ github.actor }}"
          COMMITTED_MESSAGE: "${{ github.event.head_commit.message }}"
        run:  |
          bash  /home/admin/sonarqube-test/start.sh "${{ env.CARD_TITLE }}" "${{ env.CARD_SUBTITLE }}" "${{ env.JOB }}" "${{ env.ENVIRONMENT }}" "${{ env.BRANCH }}" "${{ env.COMMITTED_BY }}" "${{ env.COMMITTED_MESSAGE}}"
